# =============================================================================
# AI CONTEXT: cdl_number Block
# Workspace: Actions
# =============================================================================

block_name: "cdl_number"
block_type: leaf
workspace: actions

# -----------------------------------------------------------------------------
# CORE INTENT
# -----------------------------------------------------------------------------
intent: |
  Represents the cdl_number state variable, a commonly used field for tracking
  whether the Commercial Driver's License (CDL) number has been collected and
  validated in driver identification flows.

description: |
  The cdl_number block is a specific instance of a state block that tracks
  the CDL number collection status. This data point is essential for driver
  identification, regulatory compliance, and security verification.
  
  Key behaviors:
  - Declares cdl_number_filled state variable initialized to False
  - Used in Pre-Conditions List to check if CDL number needs collection
  - Updated in post_effects when CDL number is successfully collected
  - Critical for DOT compliance and driver verification
  
  Related state variables:
  - cdl_number_filled: Boolean tracking if CDL was collected
  - cdl_number_validated: Boolean tracking if CDL was verified
  - cdl_number_timeout: Boolean tracking collection timeout
  - cdl_expiration_valid: Boolean tracking if CDL is not expired

# -----------------------------------------------------------------------------
# SEMANTIC ROLE
# -----------------------------------------------------------------------------
semantic_role: data_collection

# -----------------------------------------------------------------------------
# FIELD DEFINITIONS
# -----------------------------------------------------------------------------
fields:
  init:
    intent: "Initializes the cdl_number state variable with its starting value"
    description: |
      The init field contains the state variable declaration in format:
      cdl_number_filled: False
      
      This declares that the CDL number has not yet been collected.
      After successful collection, post_effects set this to True.
    value_type: "state_initialization"
    required: true
    default_behavior: |
      Should be initialized to False since CDL number starts as uncollected.
    examples:
      - "cdl_number_filled: False"
      - "cdl_number_validated: False"
      - "cdl_number_timeout: False"

# -----------------------------------------------------------------------------
# STRUCTURAL CONSTRAINTS
# -----------------------------------------------------------------------------
allowed_children: []  # Leaf block - no children

required_children:
  min: 0
  max: 0
  types: []

allowed_parents:
  - State List  # cdl_number can only exist inside State List

# -----------------------------------------------------------------------------
# RESTRICTIONS & RULES
# -----------------------------------------------------------------------------
restrictions:
  - "cdl_number blocks can ONLY exist as direct children of State List"
  - "Should always be initialized to False (uncollected state)"
  - "Must be referenced in Pre-Conditions List or post_effects to be useful"
  - "Consider adding validation state for CDL verification requirements"

# -----------------------------------------------------------------------------
# RELATIONSHIPS
# -----------------------------------------------------------------------------
relationships:
  requires:
    - State List  # Must have a State List parent
  
  pairs_with:
    - Pre-Condition  # States are checked in pre-conditions
    - Post Effect    # States are updated in post-effects
    - field          # Often paired with a field block collecting the CDL
    - driver_name    # Often collected with driver identification
  
  typically_preceded_by:
    - truck_number   # Vehicle info typically collected first
    - driver_name    # May be preceded by driver name
  
  typically_followed_by:
    - appointment_number  # May be followed by appointment verification

# -----------------------------------------------------------------------------
# USAGE EXAMPLES
# -----------------------------------------------------------------------------
examples:
  - name: "Basic cdl_number State"
    description: "Simple declaration of cdl_number_filled state"
    yaml: |
      state:
        - cdl_number_filled: False

  - name: "In State List"
    description: "cdl_number within a State List container"
    yaml: |
      State List:
        - state:
            - cdl_number_filled: False

  - name: "With Validation States"
    description: "cdl_number with validation and expiration tracking"
    yaml: |
      State List:
        - state:
            - cdl_number_filled: False
        - state:
            - cdl_number_validated: False
        - state:
            - cdl_expiration_valid: False

  - name: "Complete Card with cdl_number"
    description: "Card that collects CDL number with state tracking"
    yaml: |
      Card:
        - card_id: collect_cdl_v1
        - State List:
            - state:
                - cdl_number_filled: False
        - delivery:
            - intent:
                - intent: collect
            - interaction:
                - interaction_type: input.text
                - field:
                    - field: cdl_number
                    - label: CDL Number
                    - prompt: Please enter your Commercial Driver's License number
        - Policy:
            - Timeout:
                - timeout_sec: "45"
        - Pre-Conditions List:
            - Pre-Condition:
                - pre_condition: state.cdl_number_filled == False
        - post_effects:
            - Post Effect:
                - post_effect: state.cdl_number_filled = True

  - name: "Driver Verification Flow"
    description: "CDL collection as part of driver verification"
    yaml: |
      Card:
        - card_id: verify_driver_v1
        - State List:
            - state:
                - driver_name_filled: False
            - state:
                - cdl_number_filled: False
        - Pre-Conditions List:
            - Pre-Condition:
                - pre_condition: state.driver_name_filled == True
            - Pre-Condition:
                - pre_condition: state.cdl_number_filled == False
        - post_effects:
            - Post Effect:
                - post_effect: state.cdl_number_filled = True

  - name: "Complete Check-in with CDL"
    description: "Full check-in flow including CDL verification"
    yaml: |
      Action:
        - action: driver_check_in
        - Card:
            - card_id: collect_truck_num_v1
            - State List:
                - state:
                    - truck_number_filled: False
            - Pre-Conditions List:
                - Pre-Condition:
                    - pre_condition: state.truck_number_filled == False
            - post_effects:
                - Post Effect:
                    - post_effect: state.truck_number_filled = True
        - Card:
            - card_id: collect_cdl_v1
            - State List:
                - state:
                    - cdl_number_filled: False
            - Pre-Conditions List:
                - Pre-Condition:
                    - pre_condition: state.truck_number_filled == True
                - Pre-Condition:
                    - pre_condition: state.cdl_number_filled == False
            - post_effects:
                - Post Effect:
                    - post_effect: state.cdl_number_filled = True

# -----------------------------------------------------------------------------
# COMMON MISTAKES
# -----------------------------------------------------------------------------
common_mistakes:
  - mistake: "Using 'cdl_number' instead of 'cdl_number_filled'"
    correction: "State variables should indicate status, not the data itself"
    example_wrong: |
      state:
        - cdl_number: False  # Confusing - is this the number or status?
    example_correct: |
      state:
        - cdl_number_filled: False  # Clear - tracks if CDL was collected

  - mistake: "Initializing to True"
    correction: "State starts as False since data hasn't been collected yet"
    example_wrong: |
      state:
        - cdl_number_filled: True  # Wrong initial state
    example_correct: |
      state:
        - cdl_number_filled: False  # Correct - starts uncollected

  - mistake: "Not validating CDL format"
    correction: "CDL validation may be required for compliance"
    example_wrong: |
      # Only tracking collection, no validation
      state:
        - cdl_number_filled: False
    example_correct: |
      # Track both collection and validation for compliance
      State List:
        - state:
            - cdl_number_filled: False
        - state:
            - cdl_number_validated: False

  - mistake: "Not including in post_effects"
    correction: "If you check a state in Pre-Conditions List, update it in post_effects"
    example_wrong: |
      Card:
        - Pre-Conditions List:
            - Pre-Condition:
                - pre_condition: state.cdl_number_filled == False
        # Missing post_effects!
    example_correct: |
      Card:
        - Pre-Conditions List:
            - Pre-Condition:
                - pre_condition: state.cdl_number_filled == False
        - post_effects:
            - Post Effect:
                - post_effect: state.cdl_number_filled = True

# -----------------------------------------------------------------------------
# GENERATION HINTS
# -----------------------------------------------------------------------------
generation_hints:
  use_when:
    - "Collecting driver identification"
    - "DOT compliance verification required"
    - "Driver check-in flow"
    - "Verifying commercial driver credentials"
    - "Security and access control for drivers"
  
  do_not_use_when:
    - "Flow doesn't involve commercial drivers"
    - "Non-CDL vehicles (personal vehicles, light trucks)"
  
  keywords:
    - "CDL"
    - "commercial driver's license"
    - "driver license"
    - "driver ID"
    - "DOT"
    - "driver verification"
    - "credentials"
    - "check-in"

# -----------------------------------------------------------------------------
# DATA CONTEXT
# -----------------------------------------------------------------------------
data_context: |
  The cdl_number is typically:
  - A state-issued Commercial Driver's License number
  - Required for operating commercial motor vehicles
  - Subject to DOT (Department of Transportation) regulations
  - May be validated against federal databases
  
  CDL format by state (US examples):
  - California: 8 characters (1 letter + 7 numbers)
  - Texas: 8 numbers
  - New York: 9 characters (various formats)
  - Format varies significantly by state
  
  Validation considerations:
  - Format varies by issuing state
  - May need expiration date verification
  - Can be validated against CDLIS (Commercial Driver's License Information System)
  - Endorsements and restrictions may apply
  
  Related data points often collected together:
  - driver_name → cdl_number → cdl_state → appointment_number
  
  Compliance requirements:
  - DOT requires CDL verification for commercial operations
  - FMCSA regulations may apply
  - Some facilities require pre-registration of CDL
